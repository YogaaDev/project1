{"ast":null,"code":"import _objectSpread from\"/Users/kevin/Applications/Projets/Okto/Web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/Users/kevin/Applications/Projets/Okto/Web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/kevin/Applications/Projets/Okto/Web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/kevin/Applications/Projets/Okto/Web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import _taggedTemplateLiteral from\"/Users/kevin/Applications/Projets/Okto/Web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral\";var _templateObject,_templateObject2,_templateObject3;import{Row,Col}from\"antd\";import{withTranslation}from\"react-i18next\";import{ImgPers}from\"../../common/Img\";import{Button}from\"@material-ui/core\";import{Slide}from\"react-awesome-reveal\";import{GenContainer,BlockContainer,Content,ContentWrapperSvg,ButtonContainer,ContentInfoMint}from\"./styles\";import{ButtonPers}from\"../../common/Button\";import{useEffect,useMemo,useState}from\"react\";import styled from\"styled-components\";import Countdown from\"react-countdown\";import{CircularProgress,Snackbar}from\"@material-ui/core\";import Alert from\"@material-ui/lab/Alert\";import{LAMPORTS_PER_SOL}from\"@solana/web3.js\";import{useAnchorWallet}from\"@solana/wallet-adapter-react\";import{awaitTransactionSignatureConfirmation,getCandyMachineState,mintOneToken}from\"../../candy-machine\";import whitelistAddress from'./whitelist';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CounterText=styled.span(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\"])));var MintContainer=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\\nwidth: 100%;\\ndisplay: flex;\\njustify-content: center;\\npadding: 2rem;\\n\"])));var MintButton=styled(Button)(_templateObject3||(_templateObject3=_taggedTemplateLiteral([\"\\nborder: 5px solid #fff;\\nborder-radius: 0px;\\n\"])));var Home=function Home(props){var _useState=useState(),_useState2=_slicedToArray(_useState,2),balance=_useState2[0],setBalance=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isSoldOut=_useState4[0],setIsSoldOut=_useState4[1];// true when items remaining is zero\nvar _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),isMinting=_useState6[0],setIsMinting=_useState6[1];// true when user got to press MINT\nvar _useState7=useState(0),_useState8=_slicedToArray(_useState7,2),itemsAvailable=_useState8[0],setItemsAvailable=_useState8[1];var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),itemsRedeemed=_useState10[0],setItemsRedeemed=_useState10[1];var _useState11=useState(0),_useState12=_slicedToArray(_useState11,2),itemsRemaining=_useState12[0],setItemsRemaining=_useState12[1];var _useState13=useState(new Date(props.startDate*1000)),_useState14=_slicedToArray(_useState13,2),startDate=_useState14[0],setStartDate=_useState14[1];var isLive=useMemo(function(){return startDate<=new Date();},[startDate]);var _useState15=useState({open:false,message:\"\",severity:undefined}),_useState16=_slicedToArray(_useState15,2),alertState=_useState16[0],setAlertState=_useState16[1];var wallet=useAnchorWallet();var _useState17=useState(),_useState18=_slicedToArray(_useState17,2),candyMachine=_useState18[0],setCandyMachine=_useState18[1];var refreshCandyMachineState=function refreshCandyMachineState(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _yield$getCandyMachin,candyMachine,goLiveDate,itemsAvailable,itemsRemaining,itemsRedeemed;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(wallet){_context.next=2;break;}return _context.abrupt(\"return\");case 2:_context.next=4;return getCandyMachineState(wallet,props.candyMachineId,props.connection);case 4:_yield$getCandyMachin=_context.sent;candyMachine=_yield$getCandyMachin.candyMachine;goLiveDate=_yield$getCandyMachin.goLiveDate;itemsAvailable=_yield$getCandyMachin.itemsAvailable;itemsRemaining=_yield$getCandyMachin.itemsRemaining;itemsRedeemed=_yield$getCandyMachin.itemsRedeemed;setItemsAvailable(itemsAvailable);setItemsRemaining(itemsRemaining);setItemsRedeemed(itemsRedeemed);setIsSoldOut(itemsRemaining===0);setStartDate(goLiveDate);setCandyMachine(candyMachine);case 16:case\"end\":return _context.stop();}}},_callee);}))();};var onMint=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var _wallet$publicKey,_wallet$publicKey3,mintTxId,status,_wallet$publicKey2,message,_balance;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setIsMinting(true);// Si on est dans la whitelist ou si la whitelist est passé\nif(!(wallet&&(candyMachine===null||candyMachine===void 0?void 0:candyMachine.program)&&(whitelistAddress.includes((_wallet$publicKey=wallet.publicKey)===null||_wallet$publicKey===void 0?void 0:_wallet$publicKey.toBase58())&&itemsRedeemed<1000||itemsRedeemed>=1000))){_context2.next=12;break;}_context2.next=5;return mintOneToken(candyMachine,props.config,wallet.publicKey,props.treasury);case 5:mintTxId=_context2.sent;_context2.next=8;return awaitTransactionSignatureConfirmation(mintTxId,props.txTimeout,props.connection,\"singleGossip\",false);case 8:status=_context2.sent;if(!(status===null||status===void 0?void 0:status.err)){setAlertState({open:true,message:\"Congratulations! Mint succeeded!\",severity:\"success\"});if(wallet){whitelistAddress.splice(whitelistAddress.indexOf((_wallet$publicKey2=wallet.publicKey)===null||_wallet$publicKey2===void 0?void 0:_wallet$publicKey2.toBase58()),1);}}else{setAlertState({open:true,message:\"Mint failed! Please try again!\",severity:\"error\"});}_context2.next=13;break;case 12:// Si on est pas dans la white list et qu'on l'a pas ecore passé\nif(wallet&&(candyMachine===null||candyMachine===void 0?void 0:candyMachine.program)&&!whitelistAddress.includes((_wallet$publicKey3=wallet.publicKey)===null||_wallet$publicKey3===void 0?void 0:_wallet$publicKey3.toBase58())&&itemsRedeemed<1000){setAlertState({open:true,message:\"You are not in the whitelist, or you already mint an Okto!\",severity:\"error\"});}case 13:_context2.next=20;break;case 15:_context2.prev=15;_context2.t0=_context2[\"catch\"](0);// TODO: blech:\nmessage=_context2.t0.msg||\"Minting failed! Please try again!\";if(!_context2.t0.msg){if(_context2.t0.message.indexOf(\"0x138\")){}else if(_context2.t0.message.indexOf(\"0x137\")){message=\"SOLD OUT!\";}else if(_context2.t0.message.indexOf(\"0x135\")){message=\"Insufficient funds to mint. Please fund your wallet.\";}}else{if(_context2.t0.code===311){message=\"SOLD OUT!\";setIsSoldOut(true);}else if(_context2.t0.code===312){message=\"Minting period hasn't started yet.\";}}setAlertState({open:true,message:message,severity:\"error\"});case 20:_context2.prev=20;if(!wallet){_context2.next=26;break;}_context2.next=24;return props.connection.getBalance(wallet.publicKey);case 24:_balance=_context2.sent;setBalance(_balance/LAMPORTS_PER_SOL);case 26:setIsMinting(false);refreshCandyMachineState();return _context2.finish(20);case 29:case\"end\":return _context2.stop();}}},_callee2,null,[[0,15,20,29]]);}));return function onMint(){return _ref2.apply(this,arguments);};}();useEffect(function(){_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var _balance2;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!wallet){_context3.next=5;break;}_context3.next=3;return props.connection.getBalance(wallet.publicKey);case 3:_balance2=_context3.sent;setBalance(_balance2/LAMPORTS_PER_SOL);case 5:case\"end\":return _context3.stop();}}},_callee3);}))();},[wallet,props.connection]);useEffect(refreshCandyMachineState,[wallet,props.candyMachineId,props.connection]);return/*#__PURE__*/_jsx(GenContainer,{children:/*#__PURE__*/_jsxs(BlockContainer,{children:[/*#__PURE__*/_jsxs(Row,{justify:\"center\",align:\"middle\",children:[/*#__PURE__*/_jsx(Col,{lg:13,md:13,sm:13,xs:22,offset:1,children:/*#__PURE__*/_jsxs(Slide,{direction:\"left\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\" Say \\\"Hello\\\" to Okto.\"}),/*#__PURE__*/_jsx(Content,{children:\"4,389 Unique, Punchy, Cuty, Algorithmically generated Oktos. Stored with proof of ownership on the Solana blockchain.\"}),/*#__PURE__*/_jsx(Row,{align:\"middle\",justify:\"center\",children:/*#__PURE__*/_jsx(MintContainer,{children:isSoldOut?/*#__PURE__*/_jsx(ButtonContainer,{children:/*#__PURE__*/_jsx(ButtonPers,{children:\"View on Secondary Market\"})}):/*#__PURE__*/_jsx(MintButton,{onClick:onMint,disabled:isSoldOut||isMinting||!isLive,variant:\"text\",children:isLive&&wallet?isMinting?/*#__PURE__*/_jsx(CircularProgress,{}):/*#__PURE__*/_jsx(ButtonContainer,{children:/*#__PURE__*/_jsx(ButtonPers,{children:\"Mint for 2 SOL\"})}):startDate.getTime()/1000>86400?/*#__PURE__*/_jsx(ContentInfoMint,{children:/*#__PURE__*/_jsxs(\"b\",{children:[\"Live at : \",startDate.toUTCString()]})}):/*#__PURE__*/_jsx(ButtonContainer,{children:/*#__PURE__*/_jsx(ButtonPers,{children:/*#__PURE__*/_jsx(Countdown,{date:startDate,onComplete:function onComplete(){return refreshCandyMachineState();},renderer:renderCounter})})})})})}),/*#__PURE__*/_jsx(Content,{children:wallet&&!isSoldOut&&isLive&&/*#__PURE__*/_jsxs(ContentInfoMint,{children:[\"Available: \",itemsRemaining,\" / \",itemsAvailable,\" \\xA0\\xA0-\\xA0\\xA0 Balance: \",(balance||0).toLocaleString(),\" SOL\"]})})]})}),/*#__PURE__*/_jsx(Col,{lg:9,md:9,sm:9,xs:22,offset:1,children:/*#__PURE__*/_jsx(ContentWrapperSvg,{children:/*#__PURE__*/_jsx(ImgPers,{src:\"Okto_gif.gif\",width:\"100%\",height:\"100%\"})})})]}),/*#__PURE__*/_jsx(Snackbar,{open:alertState.open,autoHideDuration:6000,onClose:function onClose(){return setAlertState(_objectSpread(_objectSpread({},alertState),{},{open:false}));},children:/*#__PURE__*/_jsx(Alert,{onClose:function onClose(){return setAlertState(_objectSpread(_objectSpread({},alertState),{},{open:false}));},severity:alertState.severity,children:alertState.message})})]})});};var renderCounter=function renderCounter(_ref4){var days=_ref4.days,hours=_ref4.hours,minutes=_ref4.minutes,seconds=_ref4.seconds,completed=_ref4.completed;return/*#__PURE__*/_jsxs(CounterText,{children:[hours+(days||0)*24,\" hours, \",minutes,\" minutes, \",seconds,\" seconds\"]});};export default withTranslation()(Home);","map":{"version":3,"sources":["/Users/kevin/Applications/Projets/Okto/Web/src/components/Home/Home.tsx"],"names":["Row","Col","withTranslation","ImgPers","Button","Slide","GenContainer","BlockContainer","Content","ContentWrapperSvg","ButtonContainer","ContentInfoMint","ButtonPers","useEffect","useMemo","useState","styled","Countdown","CircularProgress","Snackbar","Alert","LAMPORTS_PER_SOL","useAnchorWallet","awaitTransactionSignatureConfirmation","getCandyMachineState","mintOneToken","whitelistAddress","CounterText","span","MintContainer","div","MintButton","Home","props","balance","setBalance","isSoldOut","setIsSoldOut","isMinting","setIsMinting","itemsAvailable","setItemsAvailable","itemsRedeemed","setItemsRedeemed","itemsRemaining","setItemsRemaining","Date","startDate","setStartDate","isLive","open","message","severity","undefined","alertState","setAlertState","wallet","candyMachine","setCandyMachine","refreshCandyMachineState","candyMachineId","connection","goLiveDate","onMint","program","includes","publicKey","toBase58","config","treasury","mintTxId","txTimeout","status","err","splice","indexOf","msg","code","getBalance","getTime","toUTCString","renderCounter","toLocaleString","days","hours","minutes","seconds","completed"],"mappings":"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","sourcesContent":["import { Row, Col } from \"antd\";\r\nimport { withTranslation } from \"react-i18next\";\r\nimport { ImgPers } from \"../../common/Img\";\r\nimport { Button } from \"@material-ui/core\";\r\nimport { Slide } from \"react-awesome-reveal\";\r\nimport {\r\n  GenContainer,\r\n  BlockContainer,\r\n  Content,\r\n  ContentWrapperSvg,\r\n  ButtonContainer,\r\n  ContentInfoMint,\r\n} from \"./styles\";\r\nimport { ButtonPers } from \"../../common/Button\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport Countdown from \"react-countdown\";\r\nimport { CircularProgress, Snackbar } from \"@material-ui/core\";\r\nimport Alert from \"@material-ui/lab/Alert\";\r\nimport * as anchor from \"@project-serum/anchor\";\r\nimport { LAMPORTS_PER_SOL } from \"@solana/web3.js\";\r\nimport { AnchorWallet, useAnchorWallet } from \"@solana/wallet-adapter-react\";\r\n\r\nimport {\r\n  CandyMachine,\r\n  awaitTransactionSignatureConfirmation,\r\n  getCandyMachineState,\r\n  mintOneToken,\r\n} from \"../../candy-machine\";\r\n\r\nimport whitelistAddress from './whitelist';\r\n\r\nconst CounterText = styled.span``;\r\nconst MintContainer = styled.div`\r\nwidth: 100%;\r\ndisplay: flex;\r\njustify-content: center;\r\npadding: 2rem;\r\n`;\r\nconst MintButton = styled(Button)`\r\nborder: 5px solid #fff;\r\nborder-radius: 0px;\r\n`;\r\n\r\nexport interface HomeProps {\r\n  candyMachineId: anchor.web3.PublicKey;\r\n  config: anchor.web3.PublicKey;\r\n  connection: anchor.web3.Connection;\r\n  startDate: number;\r\n  treasury: anchor.web3.PublicKey;\r\n  txTimeout: number;\r\n}\r\n\r\nconst Home = (props: HomeProps) => {\r\n\r\n  const [balance, setBalance] = useState<number>();\r\n  const [isSoldOut, setIsSoldOut] = useState(false); // true when items remaining is zero\r\n  const [isMinting, setIsMinting] = useState(false); // true when user got to press MINT\r\n  const [itemsAvailable, setItemsAvailable] = useState(0);\r\n  const [itemsRedeemed, setItemsRedeemed] = useState(0);\r\n  const [itemsRemaining, setItemsRemaining] = useState(0);\r\n  const [startDate, setStartDate] = useState(new Date(props.startDate * 1000));\r\n  const isLive = useMemo(() => startDate <= new Date(), [startDate]);\r\n\r\n\r\n  const [alertState, setAlertState] = useState<AlertState>({\r\n    open: false,\r\n    message: \"\",\r\n    severity: undefined,\r\n  });\r\n\r\n  interface IAnchorWallet extends AnchorWallet {\r\n    connected?: boolean;\r\n  }\r\n  const wallet: IAnchorWallet | undefined = useAnchorWallet();\r\n\r\n  const [candyMachine, setCandyMachine] = useState<CandyMachine>();\r\n\r\n  const refreshCandyMachineState = () => {\r\n    (async () => {\r\n      if (!wallet) return;\r\n\r\n      const {\r\n        candyMachine,\r\n        goLiveDate,\r\n        itemsAvailable,\r\n        itemsRemaining,\r\n        itemsRedeemed,\r\n      } = await getCandyMachineState(\r\n        wallet as anchor.Wallet,\r\n        props.candyMachineId,\r\n        props.connection\r\n      );\r\n\r\n      setItemsAvailable(itemsAvailable);\r\n      setItemsRemaining(itemsRemaining);\r\n      setItemsRedeemed(itemsRedeemed);\r\n\r\n      setIsSoldOut(itemsRemaining === 0);\r\n      setStartDate(goLiveDate);\r\n      setCandyMachine(candyMachine);\r\n    })();\r\n  };\r\n\r\n  const onMint = async () => {\r\n    try {\r\n      setIsMinting(true);\r\n      // Si on est dans la whitelist ou si la whitelist est passé\r\n      if (wallet && candyMachine?.program \r\n            && ( (whitelistAddress.includes(wallet.publicKey?.toBase58()) && (itemsRedeemed < 1000)) || (itemsRedeemed >= 1000) ) ) {\r\n        const mintTxId = await mintOneToken(\r\n          candyMachine,\r\n          props.config,\r\n          wallet.publicKey,\r\n          props.treasury\r\n        );\r\n\r\n        const status = await awaitTransactionSignatureConfirmation(\r\n          mintTxId,\r\n          props.txTimeout,\r\n          props.connection,\r\n          \"singleGossip\",\r\n          false\r\n        );\r\n\r\n        if (!status?.err) {\r\n          setAlertState({\r\n            open: true,\r\n            message: \"Congratulations! Mint succeeded!\",\r\n            severity: \"success\",\r\n          });\r\n          if (wallet) {\r\n            whitelistAddress.splice( whitelistAddress.indexOf(wallet.publicKey?.toBase58()), 1);\r\n          }\r\n        } else {\r\n          setAlertState({\r\n            open: true,\r\n            message: \"Mint failed! Please try again!\",\r\n            severity: \"error\",\r\n          });\r\n        }\r\n      }\r\n      // Si on est pas dans la white list et qu'on l'a pas ecore passé\r\n      else if (wallet && candyMachine?.program \r\n            && ( (!whitelistAddress.includes(wallet.publicKey?.toBase58()) && (itemsRedeemed < 1000)) ) )\r\n      {\r\n        setAlertState({\r\n          open: true,\r\n          message: \"You are not in the whitelist, or you already mint an Okto!\",\r\n          severity: \"error\",\r\n        }); \r\n      }\r\n    } catch (error: any) {\r\n      // TODO: blech:\r\n      let message = error.msg || \"Minting failed! Please try again!\";\r\n      if (!error.msg) {\r\n        if (error.message.indexOf(\"0x138\")) {\r\n        } else if (error.message.indexOf(\"0x137\")) {\r\n          message = `SOLD OUT!`;\r\n        } else if (error.message.indexOf(\"0x135\")) {\r\n          message = `Insufficient funds to mint. Please fund your wallet.`;\r\n        }\r\n      } else {\r\n        if (error.code === 311) {\r\n          message = `SOLD OUT!`;\r\n          setIsSoldOut(true);\r\n        } else if (error.code === 312) {\r\n          message = `Minting period hasn't started yet.`;\r\n        }\r\n      }\r\n\r\n      setAlertState({\r\n        open: true,\r\n        message,\r\n        severity: \"error\",\r\n      });\r\n    } finally {\r\n      if (wallet) {\r\n        const balance = await props.connection.getBalance(wallet.publicKey);\r\n        setBalance(balance / LAMPORTS_PER_SOL);\r\n      }\r\n      setIsMinting(false);\r\n      refreshCandyMachineState();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      if (wallet) {\r\n        const balance = await props.connection.getBalance(wallet.publicKey);\r\n        setBalance(balance / LAMPORTS_PER_SOL);\r\n      }\r\n    })();\r\n  }, [wallet, props.connection]);\r\n\r\n  useEffect(refreshCandyMachineState, [\r\n    wallet,\r\n    props.candyMachineId,\r\n    props.connection,\r\n  ]);\r\n\r\n  return (\r\n    <GenContainer>\r\n      <BlockContainer >\r\n\r\n        <Row justify=\"center\" align=\"middle\">\r\n    \r\n          <Col lg={13} md={13} sm={13} xs={22} offset={1}>\r\n\r\n            <Slide direction=\"left\">\r\n\r\n              <h2> Say \"Hello\" to Okto.</h2>\r\n              \r\n              <Content >\r\n                 4,389 Unique, Punchy, Cuty, Algorithmically generated Oktos. Stored with proof of ownership on the Solana blockchain. \r\n              </Content>\r\n\r\n              <Row align=\"middle\" justify=\"center\" >\r\n                <MintContainer>\r\n                  { isSoldOut ? ( <ButtonContainer><ButtonPers>View on Secondary Market</ButtonPers></ButtonContainer> ) : (\r\n                    <MintButton onClick={onMint} disabled={isSoldOut || isMinting || !isLive} variant=\"text\">\r\n                      { (isLive && wallet) ? \r\n                        ( \r\n                          isMinting ? \r\n                          ( <CircularProgress /> ) :\r\n                          ( <ButtonContainer><ButtonPers>Mint for 2 SOL</ButtonPers></ButtonContainer> )\r\n                        ) : (  \r\n                          ((startDate.getTime() / 1000) > 86400) ? \r\n                          (<ContentInfoMint><b>Live at : {startDate.toUTCString()}</b></ContentInfoMint> ) : \r\n                          (<ButtonContainer><ButtonPers><Countdown date={startDate} onComplete={() => refreshCandyMachineState()} renderer={renderCounter} /></ButtonPers></ButtonContainer>)\r\n                        )\r\n                      }\r\n                    </MintButton>\r\n                    )\r\n                  }\r\n                </MintContainer>  \r\n              </Row>\r\n              \r\n              <Content>\r\n                {wallet && !isSoldOut && isLive &&\r\n                  <ContentInfoMint>\r\n                    Available: {itemsRemaining} / {itemsAvailable} &nbsp;&nbsp;-&nbsp;&nbsp; Balance: {(balance || 0).toLocaleString()} SOL\r\n                  </ContentInfoMint>\r\n                }\r\n              </Content>\r\n      \r\n            </Slide> \r\n          </Col>\r\n\r\n          <Col lg={9} md={9} sm={9} xs={22} offset={1}> \r\n              <ContentWrapperSvg>\r\n                <ImgPers src=\"Okto_gif.gif\" width=\"100%\" height=\"100%\" />\r\n              </ContentWrapperSvg>\r\n          </Col>\r\n\r\n        </Row>\r\n\r\n        <Snackbar open={alertState.open} autoHideDuration={6000} onClose={() => setAlertState({ ...alertState, open: false })} >\r\n          <Alert\r\n            onClose={() => setAlertState({ ...alertState, open: false })}\r\n            severity={alertState.severity}\r\n          >\r\n            {alertState.message}\r\n          </Alert>\r\n        </Snackbar>\r\n\r\n      </BlockContainer>\r\n    </GenContainer>\r\n  );\r\n};\r\n\r\n\r\ninterface AlertState {\r\n  open: boolean;\r\n  message: string;\r\n  severity: \"success\" | \"info\" | \"warning\" | \"error\" | undefined;\r\n}\r\n\r\nconst renderCounter = ({ days, hours, minutes, seconds, completed }: any) => {\r\n  return (\r\n    <CounterText>\r\n      {hours + (days || 0) * 24} hours, {minutes} minutes, {seconds} seconds\r\n    </CounterText>\r\n  );\r\n};\r\n\r\nexport default withTranslation()(Home);\r\n"]},"metadata":{},"sourceType":"module"}